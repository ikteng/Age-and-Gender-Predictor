# Age-and-Gender-Predictor
This project shows the practical application of deep learning techniques for age and gender prediction by analyzing facial iamges offline and real-time.

![UTKface dataset](https://github.com/ikteng/Age-and-Gender-Predictor/blob/aea2f51ddd94cc3d3abf2e661136da0e00d76730/media/Screenshot%202024-05-21%20113638.png)

Dataset: https://www.kaggle.com/datasets/jangedoo/utkface-new

I used the crop_part1 of the dataset in this project.

# Building the Model
This program preprocesses image data, builds CNN models for age and gender prediction, trains the model using data augmentation and callbacks for regularization, and saves the trained models for future use.

## Loading and Preparing data
- load images from the crop_part1 file and extract age and gender information from the filenames
- create a DateFrame containing image paths, ages, and genders
- balance the data by undersampling ages less than or equal to 4 and filter out ages greater than or equal 80 and invalid gender values
- resize images to 200x200 pixels and prepare image data ('x') and labels ('y_age' for age prediction and 'y_gender'for gender prediction)
- Split the data into training and testing sets for age and gender prediction separately using 'train_test-split'

## Model Architecture
- build 2 separate CNN models for age and gender prediction using the Sequential API
- both models consist of convolutional layers followed by max-pooling layers for feature extraction and downsampling, followed by dense layers for classification
- the age prediction model uses mean squared error as the loss function and a ReLU activation funtion in the output layer
- the gender prediction model uses binary cross-entropy as the loss function and a sigmoid activation function in the output layer

## Model Training
- apply data augmentation techniques using ImageDataGenerator to create variations of the training images, including rotation, shifting, shearing, zooming, and horizontal flipping.
- train the age prediction model (agemodel) and the gender prediction model (genmodel) using fit method with the training data and validation data generated by ImageDataGenerator.
- define callbacks for early stopping (EarlyStopping) and model checkpointing (ModelCheckpoint) to monitor validation loss and save the best models during training.
- perform training for 30 epochs with the specified batch size and callbacks.
- Save the trained age and gender prediction models using the save method

![prediction](https://github.com/ikteng/Age-and-Gender-Predictor/blob/aea2f51ddd94cc3d3abf2e661136da0e00d76730/media/Screenshot%202024-05-21%20114127.png)

# Predictions
This program uses the saved CNN models for age and gender prediction to detect and analyze faces from images/live webcam using Haar cascade classifier, and provide predictions for age and gender with bounding boxes drawn around the detected faces.

## Load Trained/Saved Models + Haar Cascade for Face Detection
- load the pre-trained age prediction model (agemodel) and gender prediction model (genmodel) using the load_model function from Keras.
- load the Haar cascade classifier (face_cascade) for detecting faces. This classifier is used by OpenCV for face detection.

## Capture Live Video
- use OpenCV to capture live video from the default camera
- the 'while' loop continuously captures frames from the video feed
- each frame is converted to grayscale for face detection

## Process the image
- takes an images as input, processes it for prediction, and returns the predicted age and gender
- resizes the image to 200x200 pixels, normalizes pixel values, and reshapes the image to match the input shape of the models
- uses the loaded models to predict age and gender respectively
- gender prediction is rounded to either 'male' or 'female'

## Detect Faces and Predict Age + Gender
- use the Haar cascade classifier to detect faces in the grayscale frame
- draw a bounding box around it and extract the face region for each detected face
- convert the face region to a PIL Image and use the process_and_predict function to predict age and gender.
- display the predicted age and gender on the frame

## Display Results
- display the resulting frame with bounding boxes and predictions
- the loop continues until the user presses the 'q' key, upon which the loop breaks and the video capture is released
