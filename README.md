# Age-and-Gender-Predictor
This project shows the practical application of deep learning techniques for age and gender prediction by analyzing facial iamges offline and real-time.

![UTKface dataset](https://github.com/ikteng/Age-and-Gender-Predictor/blob/aea2f51ddd94cc3d3abf2e661136da0e00d76730/media/Screenshot%202024-05-21%20113638.png)

Dataset: https://www.kaggle.com/datasets/jangedoo/utkface-new
I used the crop_part1 of the dataset in this project.

## build_model.py
This program preprocesses image data, builds CNN models for age and gender prediction, trains the model using data augmentation and callbacks for regularization, and saves the trained models for future use.

### import libraries
Import necessary libaries such as pandas, numpy, keras, etc.

### loading and preparing data
- load images from the crop_part1 file and extract age and gender information from the filenames
- create a DateFrame containing image paths, ages, and genders
- balance the data by undersampling ages less than or equal to 4 and filter out ages greater than or equal 80 and invalid gender values
- resize images to 200x200 pixels and prepare image data ('x') and labels ('y_age' for age prediction and 'y_gender'for gender prediction)

### Train-Test Split
Split the data into training and testing sets for age and gender prediction separately using 'train_test-split'

### Model Architecture
- build 2 separate CNN models for age and gender prediction using the Sequential API
- both models consist of convolutional layers followed by max-pooling layers for feature extraction and downsampling, followed by dense layers for classification
- the age prediction model uses mean squared error as the loss function and a ReLU activation funtion in the output layer
- the gender prediction model uses binary cross-entropy as the loss function and a sigmoid activation function in the output layer

### Data Augmentation
Apply data augmentation techniques using ImageDataGenerator to create variations of the training images, including rotation, shifting, shearing, zooming, and horizontal flipping.

### Callbacks
Define callbacks for early stopping (EarlyStopping) and model checkpointing (ModelCheckpoint) to monitor validation loss and save the best models during training.

### Model Training
- train the age prediction model (agemodel) and the gender prediction model (genmodel) using fit method with the training data and validation data generated by ImageDataGenerator.
- perform training for 30 epochs with the specified batch size and callbacks.

### Model Saving
Save the trained age and gender prediction models using the save method

![prediction](https://github.com/ikteng/Age-and-Gender-Predictor/blob/aea2f51ddd94cc3d3abf2e661136da0e00d76730/media/Screenshot%202024-05-21%20114127.png)

## predictor.py
This program uses the saved CNN models for age and gender prediction to analyze images, detects faces using Haar cascade classifier, and provides prediction for age and gender with bounding boxes drawn around the detected faces.

### Import Libraries
Import necessary libraries including pandas, numpy, OpenCV (cv2), PIL, matplotlib, and tensorflow.

### Load Trained/Saved Models + Haar Cascade for Face Detection
- Load the pre-trained age prediction model (agemodel) and gender prediction model (genmodel) using the load_model function from Keras.
- Load the Haar cascade classifier (face_cascade) for detecting faces. This classifier is used by OpenCV for face detection.

### Process and Predict Function
- takes an images as input, processes it for prediction, and returns the predicted age and gender
- it resizes the image to 200x200 pixels, normalizes pixel values, and reshapes the iamge to match the input shape of the models
- it then uses the loaded models to predict age and gender respectively
- gender prediction is rounded to either 'male' or 'female'

### Process and Draw Boxes Function
- takes the path of an image as input, detects faces in the aimge using Haar cascade for face detection
- for each detected faces, it draws a bounding box around the face and extracts the face region
- it then converts the face region to a PIL image, uses the process and predict function to predict age and gender, and displays the results on the frame
- it display the resulting frame with bounding boxes and predictions using OpenCV

## predictor live.py
This program uses the saved CNN models for age and gender prediction to analyze faces in live video streams captured by a webcam, and provides real-time predictions for age and gender with bounding boxes drawn aroudn the detected faces.

### Import Libraries
Import necessary libraries including pandas, numpy, OpenCV (cv2), PIL, matplotlib, and tensorflow.

### Load Trained/Saved Models + Haar Cascade for Face Detection
- Load the pre-trained age prediction model (agemodel) and gender prediction model (genmodel) using the load_model function from Keras.
- Load the Haar cascade classifier (face_cascade) for detecting faces. This classifier is used by OpenCV for face detection.

### Process and Predict Function
- takes an images as input, processes it for prediction, and returns the predicted age and gender
- it resizes the image to 200x200 pixels, normalizes pixel values, and reshapes the iamge to match the input shape of the models
- it then uses the loaded models to predict age and gender respectively
- gender prediction is rounded to either 'male' or 'female'

### Capture Live Video
- use OpenCV to capture live video from the default camera
- the 'while' loop continuously captures frames from the video feed
- each frame is converted to grayscale for face detection

### Detect Faces and Predict Age + Gender
- use the Haar cascade classifier to detect faces in the grayscale frame
- for each detected face, draw a bounding box around it and extract the face region
- Convert the face region to a PIL Image and use the process_and_predict function to predict age and gender.
- Display the predicted age and gender on the frame using OpenCV's cv2.putText function.

### Display Results
- display the resulting frame with bounding boxes and predictions using cv2.imshow
- the loop continues until the user presses the 'q' key, upon which the loop breaks and the video capture is released
